{% extends "base.html" %}

{% block title %}Order Details - Admin Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="sidebar">
                <h5 class="mb-3">Admin Panel</h5>
                <nav class="nav flex-column">
                    <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_sellers') }}">
                        <i class="fas fa-store"></i> Sellers
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_customers') }}">
                        <i class="fas fa-users"></i> Customers
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_categories') }}">
                        <i class="fas fa-tags"></i> Categories
                    </a>
                    <a class="nav-link active" href="{{ url_for('admin_orders') }}">
                        <i class="fas fa-shopping-bag"></i> Orders
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_analytics') }}">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Order Details</h2>
                <a href="{{ url_for('admin_orders') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Orders
                </a>
            </div>

            <div class="row">
                <!-- Order Information -->
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Order #{{ order.order_number }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Order Status</h6>
                                    <span class="badge bg-{{ 'warning' if order.order_status == 'pending' else 'info' if order.order_status == 'confirmed' else 'primary' if order.order_status == 'shipped' else 'success' if order.order_status == 'delivered' else 'danger' }} mb-3">
                                        {{ order.order_status.title() }}
                                    </span>
                                </div>
                                <div class="col-md-6">
                                    <h6>Payment Status</h6>
                                    <span class="badge bg-{{ 'warning' if order.payment_status == 'pending' else 'success' if order.payment_status == 'completed' else 'danger' }} mb-3">
                                        {{ order.payment_status.title() }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Order Date</h6>
                                    <p>{{ order.created_at.strftime('%d %B %Y at %I:%M %p') }}</p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Total Amount</h6>
                                    <p class="h5 text-primary">â‚¹{{ "%.2f"|format(order.total_amount) }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Order Items</h5>
                        </div>
                        <div class="card-body">
                            {% for item in order_items %}
                            <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                                <div class="me-3">
                                    {% if item.image_url %}
                                    <img src="{{ url_for('static', filename=item.image_url) }}" 
                                         class="rounded" style="width: 60px; height: 60px; object-fit: cover;" alt="{{ item.name }}">
                                    {% else %}
                                    <div class="bg-light d-flex align-items-center justify-content-center rounded" 
                                         style="width: 60px; height: 60px;">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ item.name }}</h6>
                                    <p class="text-muted small mb-1">Sold by: {{ item.business_name }}</p>
                                    <p class="mb-0">Qty: {{ item.quantity }} Ã— â‚¹{{ "%.2f"|format(item.price) }}</p>
                                    <span class="badge bg-{{ 'warning' if item.status == 'pending' else 'info' if item.status == 'confirmed' else 'primary' if item.status == 'shipped' else 'success' if item.status == 'delivered' else 'danger' }}">
                                        {{ item.status.title() }}
                                    </span>
                                </div>
                                <div class="text-end">
                                    <strong>â‚¹{{ "%.2f"|format(item.total) }}</strong>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Customer & Shipping Info -->
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Customer Information</h5>
                        </div>
                        <div class="card-body">
                            <h6>{{ order.first_name }} {{ order.last_name }}</h6>
                            <p class="mb-1">ðŸ“§ {{ order.shipping_address.name if order.shipping_address.name else 'N/A' }}</p>
                            <p class="mb-0">ðŸ“ž {{ order.phone or 'Not provided' }}</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Shipping Address</h5>
                        </div>
                        <div class="card-body">
                            <address>
                                {{ order.shipping_address.name }}<br>
                                {{ order.shipping_address.address }}<br>
                                {{ order.shipping_address.city }}, {{ order.shipping_address.state }}<br>
                                {{ order.shipping_address.pincode }}<br>
                                ðŸ“ž {{ order.shipping_address.phone }}
                            </address>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}