{% extends "base.html" %}

{% block title %}Edit Product - Seller Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="sidebar">
                <h5 class="mb-3">Seller Panel</h5>
                <nav class="nav flex-column">
                    <a class="nav-link" href="{{ url_for('seller_dashboard') }}">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a class="nav-link" href="{{ url_for('seller_products') }}">
                        <i class="fas fa-box"></i> Products
                    </a>
                    <a class="nav-link" href="{{ url_for('add_product') }}">
                        <i class="fas fa-plus"></i> Add Product
                    </a>
                    <a class="nav-link" href="{{ url_for('seller_orders') }}">
                        <i class="fas fa-shopping-bag"></i> Orders
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Edit Product</h2>
                <a href="{{ url_for('seller_products') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Products
                </a>
            </div>

            <div class="card">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-8">
                                <h5 class="mb-3">Basic Information</h5>
                                
                                <div class="mb-3">
                                    <label for="name" class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           value="{{ product.name }}" required>
                                    <div class="invalid-feedback">Please provide a product name.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    <textarea class="form-control" id="description" name="description" rows="4" 
                                              placeholder="Describe your product features, specifications, etc.">{{ product.description or '' }}</textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="category_id" class="form-label">Category *</label>
                                        <select class="form-select" id="category_id" name="category_id" required>
                                            <option value="">Select Category</option>
                                            {% for category in categories %}
                                            <option value="{{ category.id }}" 
                                                    {% if category.id == product.category_id %}selected{% endif %}>
                                                {{ category.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a category.</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="brand" class="form-label">Brand</label>
                                        <input type="text" class="form-control" id="brand" name="brand" 
                                               value="{{ product.brand or '' }}">
                                    </div>
                                </div>
                                
                                <!-- Pricing -->
                                <h5 class="mb-3 mt-4">Pricing & Inventory</h5>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="price" class="form-label">Price (₹) *</label>
                                        <input type="number" class="form-control" id="price" name="price" 
                                               step="0.01" min="0" value="{{ product.price }}" required>
                                        <div class="invalid-feedback">Please provide a valid price.</div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="discount_price" class="form-label">Discount Price (₹)</label>
                                        <input type="number" class="form-control" id="discount_price" name="discount_price" 
                                               step="0.01" min="0" value="{{ product.discount_price or '' }}">
                                        <small class="text-muted">Leave empty if no discount</small>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="quantity" class="form-label">Stock Quantity *</label>
                                        <input type="number" class="form-control" id="quantity" name="quantity" 
                                               min="0" value="{{ product.quantity }}" required>
                                        <div class="invalid-feedback">Please provide stock quantity.</div>
                                    </div>
                                </div>
                                
                                <!-- Additional Details -->
                                <h5 class="mb-3 mt-4">Additional Details</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="weight" class="form-label">Weight (kg)</label>
                                        <input type="number" class="form-control" id="weight" name="weight" 
                                               step="0.01" min="0" value="{{ product.weight or '' }}">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="dimensions" class="form-label">Dimensions</label>
                                        <input type="text" class="form-control" id="dimensions" name="dimensions" 
                                               placeholder="e.g., 10cm x 5cm x 2cm" value="{{ product.dimensions or '' }}">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Image Upload -->
                            <div class="col-md-4">
                                <h5 class="mb-3">Product Image</h5>
                                
                                <!-- Current Image -->
                                {% if product.image_url %}
                                <div class="mb-3">
                                    <label class="form-label">Current Image</label>
                                    <div class="text-center">
                                        <img src="{{ product.image_url | image_url }}" 
                                             class="img-thumbnail" style="max-width: 100%; max-height: 200px;">
                                    </div>
                                </div>
                                {% endif %}
                                
                                <div class="mb-3">
                                    <label for="image" class="form-label">
                                        {% if product.image_url %}Update Image{% else %}Upload Image{% endif %}
                                    </label>
                                    <input type="file" class="form-control" id="image" name="image" 
                                           accept="image/*" onchange="previewImage(this)">
                                    <small class="text-muted">Supported formats: JPG, PNG, GIF (Max: 16MB)</small>
                                </div>
                                
                                <div id="imagePreview" class="text-center" style="display: none;">
                                    <img id="preview" class="img-thumbnail" style="max-width: 100%; max-height: 300px;">
                                </div>
                                
                                <div class="alert alert-info mt-3">
                                    <small>
                                        <strong>Tips:</strong><br>
                                        • Use high-quality images<br>
                                        • Show product from multiple angles<br>
                                        • Ensure good lighting<br>
                                        • Avoid watermarks
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{{ url_for('seller_products') }}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Price validation
document.getElementById('discount_price').addEventListener('input', function() {
    const price = parseFloat(document.getElementById('price').value) || 0;
    const discountPrice = parseFloat(this.value) || 0;
    
    if (discountPrice > price && price > 0) {
        this.setCustomValidity('Discount price cannot be higher than regular price');
    } else {
        this.setCustomValidity('');
    }
});
</script>
{% endblock %}